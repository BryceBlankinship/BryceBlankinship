<!DOCTYPE html>
<html>

<head>
    <title>Welcome</title>
    <link rel="stylesheet" href="styles/whitepage.css" />

    <!-- Firebase Auth -->
    <!-- Import and configure the Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script>
    <!-- These scripts are made available when the app is served or deployed on Firebase Hosting -->
    <!-- If you do not serve/host your project using Firebase Hosting see https://firebase.google.com/docs/web/setup -->
    <script src="/__/firebase/9.1.3/firebase-app-compat.js"></script>
    <script src="/__/firebase/9.1.3/firebase-auth-compat.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script type="text/javascript">

        /*
         * Handles the sign in button press
         */
        function toggleSignIn() {
            if (firebase.auth().currentUser) {
                firebase.auth().signOut();
            } else {
                var email = document.getElementById('signinemail').value;
                var password = document.getElementById('signinpassword').value;

                if (email.length < 4) {
                    alert('Please enter a valid email address.');
                    return;
                }

                if (password.length < 6) {
                    alert('Please enter a password over 6 characters.');
                    return;
                }
                // Sign in with email and pass.
                firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    if (errorCode === 'auth/wrong-password') {
                        alert('Wrong password.');
                    } else {
                        alert(errorMessage);
                    }
                    console.log(error);
                    //document.getElementById('signinButton').disabled = false;
                });
            }
            //document.getElementById('signinButton').disabled = true;
        }

        /*
         * Handles the sign up button press
         */
        function handleSignUp() {
            var email = document.getElementById('signupemail').value;
            var password = document.getElementById('signuppassword').value;

            if (email.length < 4) {
                alert('Please enter a valid email address.');
                return;
            }

            if (password.length < 6) {
                alert('Please enter a password over 6 characters.');
                return;
            }

            // Create user with email and password
            firebase.auth().createUserWithEmailAndPassword(email, password).catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                if (errorCode == 'auth/weak-password') {
                    alert('Please create a secure password.');
                } else if (errorCode == 'auth/email-already-in-use') {
                    displaySignin();
                    //DOM loads after so it overwrites this. Not a big deal the user may be puzzled however but they can continue to sign in.
                    document.getElementById('switchtosignin').textContent = 'That email was already registered. Please sign in.';
                    console.log("User is already registered. Please sign in.")
                }
                console.log(error);
            });
        }
        /*
         * initApp handles setting up UI event listeners and registering Firebase auth listeners:
         *  - firebase.auth().onAuthStateChanged: This listener is called when the user is signed in or
         *    out, and that is where we update the UI.
         */
        function initApp() {
            // Listening for auth state changes.
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    console.log("User is signed in.");
                    //var displayName = user.displayName;
                    var userInfo={
                        name: document.getElementById('username').value
                    };
                    var email = user.email;
                    var emailVerified = user.emailVerified;
                    var photoURL = user.photoURL;
                    var isAnonymous = user.isAnonymous;
                    var uid = user.uid;
                    var providerData = user.providerData;
                    //setUserInfo(displayName, email);
                    window.location.replace("/dashboard.html");
                } else {
                    console.log("User is signed out.")
                    // User is signed out.
                    //document.getElementById('signupButton').className = 'btn btn-primary btn-lg enabled';
                    document.getElementById('signupButton').addEventListener('click', handleSignUp, true);
                }
            });
            document.getElementById('signupButton').addEventListener('click', handleSignUp, true);
        }
        window.onload = function () {
            initApp();
        };
    </script>
    <script src="js/dashboard.js"></script>
    <!-- End Firebase Auth -->
</head>

<body class="ssobody">

    <a class="header-left" href="/index.html">&larr; Take me back home</a>

    <div class="signupFrm" id="signup">
        <form action="" class="form">
            <h1 class="title">Sign up</h1>

            <div class="inputContainer">
                <input type="text" class="input" id="username" placeholder="a">
                <label for="" class="label">Full Name</label>
            </div>

            <div class="inputContainer">
                <input type="text" class="input" id="signupemail" placeholder="a">
                <label for="" class="label">Email</label>
            </div>

            <div class="inputContainer">
                <input type="password" class="input" id="signuppassword" placeholder="a">
                <label for="" class="label">Password</label>
            </div>

            <h3 id="switchtosignin">Already registered? <a onclick="displaySignin()">Sign in here.</a></h4>
                <input type="submit" class="submitBtn" id="signupButton" value="Sign up"
                    onclick="event.preventDefault();">
        </form>
    </div>

    <div class="signupFrm" id="signin">
        <form action="" class="form">
            <h1 class="title">Sign in</h1>

            <div class="inputContainer">
                <input type="text" class="input" id="signinemail" placeholder="a">
                <label for="" class="label">Email</label>
            </div>

            <div class="inputContainer">
                <input type="password" class="input" id="signinpassword" placeholder="a">
                <label for="" class="label">Password</label>
            </div>

            <h3 id="switchtosignin">Don't have an account yet? <a onclick="displaySignup()">Sign up here.</a></h4>
                <input type="submit" class="submitBtn" id="signinButton" value="Sign in"
                    onclick="event.preventDefault();">
        </form>
    </div>

    <script src="js/index.js"></script>
</body>
<footer>


</footer>

</html>